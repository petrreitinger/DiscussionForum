<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Search Results for: ' + ${query} + ' - Discussion Forum'">Search Results - Discussion Forum</title>
    
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom Forum-style CSS -->
    <link rel="stylesheet" th:href="@{/css/forum-style.css?v=4}">
</head>
<body>

<!-- Header -->
<div th:replace="~{fragments/layout :: header}"></div>

<div class="main-container">
    <main class="content-area">
        <!-- Search Results Header -->
        <div class="d-flex align-items-center mb-4">
            <i class="fas fa-search fa-2x text-primary me-3"></i>
            <div>
                <h1 class="h3 mb-1">Search Results</h1>
                <p class="text-muted mb-0" th:text="'Results for: ' + ${query}">Results for: query</p>
            </div>
        </div>

        <!-- New Search Form -->
        <div class="post-card mb-4">
            <div class="p-3">
                <form th:action="@{/search/results}" method="get" class="row g-3">
                    <div class="col-md-6">
                        <input type="text" class="form-control" name="query" th:value="${query}" 
                               placeholder="Search again..." required>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" name="type">
                            <option value="all" th:selected="${type == 'all'}">All</option>
                            <option value="posts" th:selected="${type == 'posts'}">Posts</option>
                            <option value="comments" th:selected="${type == 'comments'}">Comments</option>
                            <option value="users" th:selected="${type == 'users'}">Users</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Results Summary -->
        <div class="mb-3" th:if="${results.hasResults()}">
            <small class="text-muted">
                <span th:if="${results.posts != null && results.posts.hasContent()}" 
                      th:text="${results.posts.totalElements} + ' posts'">0 posts</span>
                <span th:if="${results.comments != null && results.comments.hasContent()}" 
                      th:text="(${results.posts != null && results.posts.hasContent()} ? ', ' : '') + ${results.comments.totalElements} + ' comments'">0 comments</span>
                <span th:if="${results.users != null && results.users.hasContent()}" 
                      th:text="((${results.posts != null && results.posts.hasContent()} || ${results.comments != null && results.comments.hasContent()}) ? ', ' : '') + ${results.users.totalElements} + ' users'">0 users</span>
            </small>
        </div>

        <!-- Posts Results -->
        <div th:if="${results.posts != null && results.posts.hasContent()}" class="mb-4">
            <h4 class="h5 mb-3"><i class="fas fa-file-text"></i> Posts</h4>
            <div th:each="post : ${results.posts.content}" class="post-card mb-3">
                <div class="p-3">
                    <h5 class="mb-2">
                        <a th:href="@{/posts/{id}(id=${post.id})}" class="text-decoration-none" th:text="${post.title}">Post Title</a>
                    </h5>
                    <p class="text-muted small mb-2">
                        by <strong th:text="'u/' + ${post.author.displayName ?: post.author.username}">u/author</strong> 
                        in <a th:href="@{/c/{name}(name=${post.community.name})}" class="text-decoration-none" th:text="${post.community.name}">community</a>
                        • <span th:text="${#temporals.format(post.createdAt, 'MMM dd, yyyy HH:mm')}">date</span>
                    </p>
                    <p class="mb-1" th:text="${#strings.abbreviate(post.content, 150)}">Post content preview...</p>
                    <div class="small text-muted">
                        <i class="fas fa-arrow-up"></i> <span th:text="${post.score}">0</span>
                        <i class="fas fa-comment ms-3"></i> <span th:text="${post.commentCount}">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Comments Results -->
        <div th:if="${results.comments != null && results.comments.hasContent()}" class="mb-4">
            <h4 class="h5 mb-3"><i class="fas fa-comment"></i> Comments</h4>
            <div th:each="comment : ${results.comments.content}" class="post-card mb-3">
                <div class="p-3">
                    <p class="mb-2" th:text="${comment.content}">Comment content</p>
                    <p class="text-muted small mb-0">
                        by <strong th:text="'u/' + ${comment.author.displayName ?: comment.author.username}">u/author</strong>
                        on <a th:href="@{/posts/{id}(id=${comment.post.id})}" class="text-decoration-none" th:text="${comment.post.title}">Post Title</a>
                        • <span th:text="${#temporals.format(comment.createdAt, 'MMM dd, yyyy HH:mm')}">date</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Users Results -->
        <div th:if="${results.users != null && results.users.hasContent()}" class="mb-4">
            <h4 class="h5 mb-3"><i class="fas fa-users"></i> Users</h4>
            <div th:each="user : ${results.users.content}" class="post-card mb-3">
                <div class="p-3 d-flex align-items-center">
                    <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3" 
                         style="width: 40px; height: 40px; font-weight: bold;"
                         th:text="${#strings.substring(user.displayName ?: user.username, 0, 1).toUpperCase()}">U</div>
                    <div>
                        <h6 class="mb-1" th:text="${user.displayName ?: user.username}">Display Name</h6>
                        <p class="text-muted small mb-0" th:text="'u/' + ${user.username}">u/username</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- No Results -->
        <div th:unless="${results.hasResults()}" class="text-center py-5">
            <i class="fas fa-search fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">No results found</h4>
            <p class="text-muted">Try different search terms or search in a different category.</p>
            <a th:href="@{/search}" class="btn btn-primary">
                <i class="fas fa-search"></i> New Search
            </a>
        </div>

        <!-- Pagination -->
        <div th:if="${results.hasResults()}" class="d-flex justify-content-center mt-4">
            <!-- Add pagination logic here if needed -->
        </div>

    </main>
    
    <aside class="sidebar d-none d-xl-block">
        <div th:replace="~{fragments/layout :: sidebar}"></div>
    </aside>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Custom JS -->
<script th:src="@{/js/app.js}"></script>

</body>
</html>